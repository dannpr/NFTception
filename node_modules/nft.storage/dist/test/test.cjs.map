{"version":3,"file":"test.cjs","sources":["../../test/test.js"],"sourcesContent":["import { activate, deactivate } from './mock-server.js'\nimport { init, handle } from './service.js'\nimport { spawn } from 'child_process'\n\nconst main = async () => {\n  const [, , command, ...args] = process.argv\n  const AUTH_TOKEN = Math.random().toString(32).slice(2)\n  const CID = `bafyreigdcnuc6w7stviim6a5m7uwqdw6p3z5zrqr22xt3num3ozra4ciqi`\n  const pieceCid =\n    'bagayreigdcnuc6w7stviim6a5m7uwqdw6p3z5zrqr22xt3num3ozra4ciqi'\n  const created = new Date()\n\n  const service = await activate(\n    init(\n      AUTH_TOKEN,\n      new Map([\n        [\n          `${AUTH_TOKEN}:${CID}`,\n          {\n            cid: CID,\n            deals: [\n              {\n                lastChanged: '2021-03-18T11:46:50.000Z',\n                status: 'queued',\n              },\n              {\n                batchRootCid: CID,\n                lastChanged: '2021-03-18T11:46:50.000Z',\n                miner: 't01234',\n                network: 'nerpanet',\n                pieceCid,\n                status: 'proposing',\n              },\n              {\n                batchRootCid: CID,\n                lastChanged: '2021-03-18T11:46:50.000Z',\n                miner: 'f05678',\n                network: 'mainnet',\n                pieceCid,\n                status: 'accepted',\n              },\n              {\n                batchRootCid: CID,\n                lastChanged: '2021-03-18T11:46:50.000Z',\n                miner: 'f09999',\n                network: 'mainnet',\n                pieceCid,\n                status: 'failed',\n                statusText: 'miner rejected my stuffz',\n              },\n              {\n                batchRootCid: CID,\n                chainDealID: 24526235,\n                dealActivation: '2021-03-18T11:46:50.000Z',\n                dealExpiration: '2021-03-18T11:46:50.000Z',\n                lastChanged: '2021-03-18T11:46:50.000Z',\n                miner: 'f34523',\n                network: 'mainnet',\n                pieceCid,\n                status: 'active',\n              },\n            ],\n            pin: {\n              cid: CID,\n              status: 'pinned',\n              created: created.toString(),\n            },\n            created: created.toString(),\n          },\n        ],\n      ])\n    ),\n    handle\n  )\n\n  console.log(`Mock service running on: ${service.url}`)\n\n  const test = spawn(`${command}`, args, {\n    stdio: 'inherit',\n    env: {\n      ...process.env,\n      AUTH_TOKEN,\n      SERVICE_ENDPOINT: `${service.url}`,\n    },\n  })\n\n  const code = await new Promise((resolve) =>\n    test.once('exit', (code) => resolve(code))\n  )\n\n  deactivate(service)\n  process.exit(code)\n}\n\nmain()\n"],"names":["service","activate","init","handle","spawn","deactivate"],"mappings":"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"}